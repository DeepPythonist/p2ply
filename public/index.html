<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>P2Ply Secure</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app">
        <!-- Header -->
        <header>
            <h1>P2Ply</h1>
            <div id="connection-status" class="status disconnected">Disconnected</div>
        </header>

        <!-- Setup Panel (Initial View) -->
        <div id="setup-panel">
            <div class="card">
                <h2>Your Identity</h2>
                <div class="fingerprint-display" id="my-fingerprint">Generating...</div>
            </div>

            <div class="card">
                <h2>New Session</h2>
                <button id="btn-create" class="success">Create Secure Room</button>

                <div id="code-display" class="hidden" style="margin-top: 15px; text-align: center;">
                    <p style="color: var(--text-muted); font-size: 0.9rem;">Share Code:</p>
                    <h3 id="pairing-code" style="font-size: 2.5rem; color: var(--text-main); margin: 10px 0;">...</h3>
                    <p style="font-size: 0.8rem; color: var(--danger);">Expires in 60s</p>
                    <button id="btn-copy-link" class="secondary" style="margin-top: 10px;">Copy Invite Link</button>
                </div>
            </div>

            <div class="separator">OR</div>

            <div class="card">
                <h2>Join Session</h2>
                <input type="number" id="input-code" placeholder="Enter 6-digit code">
                <button id="btn-join">Join Room</button>
            </div>
        </div>

        <!-- Chat Panel (Active Session) -->
        <div id="chat-panel" class="hidden">

            <!-- Verification Overlay -->
            <div id="verify-modal" class="hidden">
                <h2>Security Check</h2>
                <p>Do these fingerprints match?</p>

                <div style="margin-bottom: 20px;">
                    <small style="color: var(--accent);">YOUR FINGERPRINT</small>
                    <div id="modal-my-fingerprint" class="verification-code"
                        style="font-size: 1.2rem; color: var(--accent);">...</div>
                </div>

                <div style="margin-bottom: 30px;">
                    <small style="color: var(--primary);">PEER FINGERPRINT</small>
                    <div id="peer-fingerprint-display" class="verification-code"
                        style="font-size: 1.5rem; color: var(--primary);">...</div>
                </div>

                <div style="display: flex; gap: 10px; width: 100%; max-width: 300px;">
                    <button id="btn-verify-confirm" class="success">YES, CONNECT</button>
                    <button id="btn-verify-reject" class="danger">NO, REJECT</button>
                </div>
            </div>

            <!-- Active Chat View -->
            <div id="secure-chat-view" class="hidden">
                <div
                    style="padding: 10px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.8rem; color: var(--accent);">● Secure Connection</span>
                    <button id="btn-kill" class="danger" style="width: auto; padding: 8px 12px; font-size: 0.7rem;">END
                        SESSION</button>
                </div>

                <div id="messages">
                    <div style="text-align: center; margin-top: 20px; color: var(--text-muted); font-size: 0.8rem;">
                        Messages are end-to-end encrypted.<br>No data is saved on any server.
                    </div>
                </div>

                <div class="input-area">

                    <input type="text" id="msg-input" placeholder="Type message..." autocomplete="off">
                    <button id="btn-send">➤</button>
                </div>
            </div>
        </div>
        <!-- Footer -->
        <footer
            style="margin-top: auto; padding: 15px; text-align: center; font-size: 0.7rem; color: var(--text-muted); border-top: 1px solid var(--border);">
            <p>Open Source & Secure</p>
            <a href="https://github.com/DeepPythonist/p2ply.git" target="_blank"
                style="color: var(--primary); text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 5px; margin-top: 5px;">
                <svg height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"
                    style="fill: currentColor;">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                    </path>
                </svg>
                DeepPythonist/p2ply
            </a>
        </footer>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="app.js"></script>
</body>

</html>